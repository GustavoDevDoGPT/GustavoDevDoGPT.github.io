<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Brand√£o Im√≥veis</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="js/supabase.js"></script>
  <link rel="icon" type="image/png" href="images/favicon.png">
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <h1>Brand√£o Im√≥veis</h1>
  </header>

  <main>
    <section id="filtros">

      <!-- Estado -->
      <select id="estado">
        <option value="">Estado</option>
        <option value="S√£o Paulo">S√£o Paulo</option>
        <option value="Rio de Janeiro">Rio de Janeiro</option>
        <option value="Minas Gerais">Minas Gerais</option>
      </select>

      <!-- Cidade (din√¢mico) -->
      <select id="cidade" disabled>
        <option value="">Selecione o estado primeiro</option>
      </select>

      <!-- Tipo -->
      <select id="tipo">
        <option value="">Tipo</option>
        <option value="Casa">Casa</option>
        <option value="Apartamento">Apartamento</option>
      </select>

      <!-- Disponibilidade -->
      <select id="disponibilidade">
        <option value="">Disponibilidade</option>
        <option value="Alugar">Alugar</option>
        <option value="Comprar">Comprar</option>
      </select>

      <!-- Faixa de pre√ßo -->
      <select id="preco">
        <option value="">Faixa de pre√ßo</option>
        <option value="0-200000">At√© R$ 200 mil</option>
        <option value="200000-500000">R$ 200 mil a R$ 500 mil</option>
        <option value="500000-1000000">R$ 500 mil a R$ 1 milh√£o</option>
        <option value="1000000-999999999">Acima de R$ 1 milh√£o</option>
      </select>

      <!-- Quartos -->
      <select id="quartos">
        <option value="">Quartos</option>
        <option value="1">1+</option>
        <option value="2">2+</option>
        <option value="3">3+</option>
        <option value="4">4+</option>
      </select>

      <!-- Banheiros -->
      <select id="banheiros">
        <option value="">Banheiros</option>
        <option value="1">1+</option>
        <option value="2">2+</option>
        <option value="3">3+</option>
      </select>

      <button id="filtrar">Filtrar</button>
    </section>
    
    <div id="lista-imoveis" class="grid"></div>
  </main>

  <script>
  // üó∫Ô∏è Lista de cidades por estado
  const cidadesPorEstado = {
    "S√£o Paulo": ["S√£o Paulo", "Campinas", "Santos", "Sorocaba"],
    "Rio de Janeiro": ["Rio de Janeiro", "Niter√≥i", "Petr√≥polis"],
    "Minas Gerais": ["Belo Horizonte", "Uberl√¢ndia", "Juiz de Fora"]
  };

  const estadoSelect = document.getElementById("estado");
  const cidadeSelect = document.getElementById("cidade");

  // Quando muda o estado ‚ûú atualiza as cidades
  estadoSelect.addEventListener("change", () => {
    const estado = estadoSelect.value;
    cidadeSelect.innerHTML = "";
    
    if (!estado) {
      cidadeSelect.disabled = true;
      cidadeSelect.innerHTML = `<option value="">Selecione o estado primeiro</option>`;
      return;
    }

    // Popula as cidades do estado escolhido
    const cidades = cidadesPorEstado[estado] || [];
    cidadeSelect.disabled = false;
    cidadeSelect.innerHTML = `<option value="">Cidade</option>`;
    cidades.forEach(cidade => {
      const option = document.createElement("option");
      option.value = cidade;
      option.textContent = cidade;
      cidadeSelect.appendChild(option);
    });
  });

  // üîç Fun√ß√£o para carregar im√≥veis do Supabase
  async function carregarImoveis(filtros = {}) {
    let query = supabase.from("imoveis").select("*");

    if (filtros.estado) query = query.eq("estado", filtros.estado);
    if (filtros.cidade) query = query.eq("cidade", filtros.cidade);
    if (filtros.tipo) query = query.eq("tipo", filtros.tipo);
    if (filtros.disponibilidade) query = query.eq("disponibilidade", filtros.disponibilidade);
    if (filtros.preco) {
      const [min, max] = filtros.preco.split("-").map(Number);
      query = query.gte("preco", min).lte("preco", max);
    }
    if (filtros.quartos) query = query.gte("quartos", filtros.quartos);
    if (filtros.banheiros) query = query.gte("banheiros", filtros.banheiros);

    const { data, error } = await query;
    if (error) {
      console.error(error);
      return;
    }

    const container = document.getElementById("lista-imoveis");
    container.innerHTML = "";

    if (data.length === 0) {
      container.innerHTML = `<p style="text-align:center;">Nenhum im√≥vel encontrado üòï</p>`;
      return;
    }

    data.forEach(imovel => {
      container.innerHTML += `
        <div class="card">
          <img src="${imovel.imagem_url || 'images/default.jpg'}" alt="${imovel.titulo}" />
          <h2>${imovel.titulo}</h2>
          <p>${imovel.tipo} ‚Ä¢ ${imovel.quartos} quartos ‚Ä¢ ${imovel.area_m2}m¬≤</p>
          <p>${imovel.bairro} - ${imovel.cidade}</p>
          <strong>R$ ${Number(imovel.preco).toLocaleString('pt-BR')}</strong>
          <a href="detalhes.html?id=${imovel.id}" class="botao">Ver mais detalhes</a>
        </div>
      `;
    });
  }

  // üîò Evento do bot√£o de filtro
  document.getElementById("filtrar").addEventListener("click", () => {
    const filtros = {
      estado: document.getElementById("estado").value,
      cidade: document.getElementById("cidade").value,
      tipo: document.getElementById("tipo").value,
      disponibilidade: document.getElementById("disponibilidade").value,
      preco: document.getElementById("preco").value,
      quartos: document.getElementById("quartos").value,
      banheiros: document.getElementById("banheiros").value,
    };
    carregarImoveis(filtros);
  });

  // üîÑ Carregar todos os im√≥veis no in√≠cio
  carregarImoveis();
  </script>
</body>
</html>
